# Datalab Infrastructure

NOTE: 99% of this repo is generated by github copilot agent in a "vibe coding experiment"

This Terraform configuration deploys a complete data lab environment on Azure, including:

- Azure Databricks workspace with Unity Catalog
- Azure SQL Server and database
- Virtual network with proper subnet delegation
- Network security groups

## File Structure

- `main.tf` - Terraform configuration and provider setup
- `variables.tf` - Variable declarations
- `outputs.tf` - Output values
- `networking.tf` - Virtual network, subnets, and security groups
- `databricks.tf` - Databricks workspace and Unity Catalog
- `database.tf` - SQL Server, database, and firewall rules
- `terraform.tfvars.example` - Example variables file

## Prerequisites

1. Terraform installed (>= 1.0)
2. Azure CLI installed and authenticated
3. Databricks account with account ID
4. Appropriate Azure permissions

## Deployment

1. **Set up your variables file:**
   ```powershell
   Copy-Item terraform.tfvars.example terraform.tfvars
   ```

2. **Edit `terraform.tfvars` with your values:**
   - `location`: Azure region (e.g., "West Europe")
   - `resource_group_name`: Name of the resource group (must exist)
   - `databricks_account_id`: Your Databricks account ID
   - `sql_admin_username`: SQL Server admin username
   - `sql_admin_password`: SQL Server admin password (use a strong password)
   - `environment`: Environment name (dev, staging, prod)
   - `project_name`: Project name for resource naming

3. **Initialize Terraform:**
   ```powershell
   terraform init
   ```

4. **Validate the configuration:**
   ```powershell
   terraform validate
   ```

5. **Plan the deployment:**
   ```powershell
   terraform plan
   ```

6. **Apply the configuration:**
   ```powershell
   terraform apply -auto-approve
   ```

After successful deployment, you can access your resources through the [Azure Portal](https://portal.azure.com).

## Security Considerations

- SQL Server firewall rules are configured to allow Azure services and Databricks subnets
- Network security groups are attached to subnets for additional security
- Subnet delegation is properly configured for Databricks
- Sensitive variables (passwords) are marked as sensitive

## Outputs

After deployment, the following values will be available:
- Databricks workspace ID and URL
- SQL Server FQDN
- Virtual network ID
- Unity Catalog metastore ID

## Cleanup

To destroy the infrastructure:
```powershell
terraform destroy
```
